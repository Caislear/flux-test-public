name: terraform-lint
on:
  push:
    branches:
    - flux-dev-*
jobs:
  check-for-flux:
    name: Check if Flux branch
    runs-on: ubuntu-latest
    outputs:
      status: "startsWith( (github.head_ref || github.ref_name) , 'flux-')"
    steps:
      - id: test-if-flux-branch
        name: Flux branch test
        run: echo 'Check if flux'

  terraform-lint:
    needs: check-for-flux
    if: "!needs.check-for-flux.outputs.status"
    name: terraform-fmt
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Check format 
        run: terraform fmt -check -recursive
      - name: Attmempt env output
        run: env
      - name: Attempt echo of github ref
        run: echo $GITHUB_REF
      - name: Attempt echo of github ref_name
        run: echo $GITHUB_REF_NAME

