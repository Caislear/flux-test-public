name: terraform-lint
on:
  push:
    branches:
    - flux-dev-*
jobs:
  check-for-flux:
    name: Check if Flux branch
    runs-on: ubuntu-latest
    steps:
      - id: is-flux-branch
        name: Flux branch test
        env:
          STATUS: ${{ "startsWith( (github.head_ref || github.ref_name) , 'flux-')" }}
        run: |-
        echo "head_ref: $GITHUB_HEAD_REF" && 
        echo "ref_name: $GITHUB_REF_NAME" && 
        echo "STATUS=$STATUS" >> $GITHUB_OUTPUT

  terraform-lint:
    needs: check-for-flux
    if: "!needs.check-for-flux.is-flux-branch.outputs.STATUS"
    name: terraform-fmt
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Check format 
        run: terraform fmt -check -recursive
      - name: Attmempt env output
        run: env
      - name: Attempt echo of github ref
        run: echo $GITHUB_REF
      - name: Attempt echo of github ref_name
        run: echo $GITHUB_REF_NAME

